from XSS_Scanner import XssScanner           # importing website xss scanner
from XSS_Attack_Search import XssAttack      # importing class for searching attacks
from LFI_Scanner import LFIScanner           # Importing class for LFI scan
from pprint import  pprint                   # For proper HTML form displaying
import sys

# Function for displaying menu and scan choice
def ShowMenu(attacksTypes):
    print(f'Please choose scan type:')
    for i, at in enumerate(attacksTypes):
        print('[*] Press', i+1, 'for', at)
    userInput = input()
    return int(userInput)

# running choosen test
def RunTest(choice):
    if choice == 1:
        xssAttack = XssAttack()                                 #create XssAttack object
        url = xssAttack.get_url()                               #get uder's URL
        payloads_path = xssAttack.get_payloads_path()           #get path to payloads
        xssAttack.create_driver_chrome()                        #create chrome webdriver
        xssAttack.find_xss_attack(url, payloads_path)           #perform attack
    elif choice == 2:
        xssScan = XssScanner()                                  #create XssScanner object
        url = xssScan.get_url()                                 #get user's URL
        user_script = xssScan.get_script()                      #get user's script
        forms = xssScan.get_forms_html(url)                     #get all forms from website
        print('[*] Number of detected forms on site:', len(forms))

        for form in forms:
            form_details = xssScan.get_form_details(form)       #get form details
            content = xssScan.send_form(form_details, url, user_script).content.decode()   #submiting modified form
            if user_script in content:                          #looking for user's script in received response
                print('[*] Detected, Form details:')
                pprint(form_details)
                print('[*] Vulnerability detected!')
    elif choice == 3:
        lfiScan = LFIScanner()                                  #create LFIScanner object
        url = lfiScan.get_url()                                 #get user's URL
        payloads_path = lfiScan.get_payloads_path()             #get path to payloads
        lfiScan.lfi_scan(url, payloads_path)                    #perform SCAN
    elif choice == 4:
        pass
    elif choice == 5:
        pass
    elif choice == 6:
        sys.exit()
    else:
        print('Error, Please choose proper action')

def Main():
    attacksTypes = ["XSS Attack on site - URL with payloads list",
                    "XSS site's Vulnerability Test for user's script (through searching forms)",
                    "LFI vulnerability test - through attack",
                    "czwarty",
                    "piaty",
                    "Exit"]
    while True:
        choice = ShowMenu(attacksTypes)
        RunTest(choice)

if __name__ == "__main__":
    Main()